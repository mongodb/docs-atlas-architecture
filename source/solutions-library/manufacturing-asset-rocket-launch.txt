.. _arch-center-is-rocket-launch:

=====================================
App-Driven Intelligence with IoT data
=====================================

.. facet::
   :name: genre
   :values: tutorial

.. meta:: 
   :keywords: Internet of Things, IoT, Manufacturing, Analytics
   :description: Create real-time analysis on IoT data on the MongoDB developer data platform

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Monitoring a rocket launch using MongoDB Atlas and real-time IoT data.

**Use cases:** `Analytics <https://www.mongodb.com/solutions/use-cases/analytics>`__,
`IoT <https://www.mongodb.com/solutions/use-cases/internet-of-things>`__

**Industries:** `Manufacturing and Mobility <https://www.mongodb.com/solutions/industries/manufacturing>`__,
`Retail <https://www.mongodb.com/solutions/industries/retail>`__

**Products:** `MongoDB Atlas <http://mongodb.com/atlas>`__, 
`MongoDB Aggregation Pipeline <https://www.mongodb.com/docs/v7.0/core/aggregation-pipeline/>`__,
`MongoDB Time Series <https://www.mongodb.com/products/capabilities/time-series>`__,
`Atlas Charts <https://www.mongodb.com/products/platform/atlas-charts>`__,
`Atlas Database <https://www.mongodb.com/products/platform/atlas-database>`__,
`Atlas Data Federation <https://www.mongodb.com/products/platform/atlas-data-federation>`__,
`Atlas Search <https://www.mongodb.com/products/platform/atlas-search>`__,
`Atlas SQL Interface <https://www.mongodb.com/products/platform/atlas-sql-interface>`__,
`Atlas Triggers <https://www.mongodb.com/docs/atlas/atlas-ui/triggers/>`__

**Partners:** `Amazon S3 <https://www.mongodb.com/products/platform/atlas-cloud-providers/aws>`__,
`Tableau <https://www.mongodb.com/try/download/tableau-connector>`__

Solution Overview
-----------------

From manufacturing and transportation to logistics and supply chain, the
ability to perform real-time analysis on live IoT data during operation,
and combine it with other data sources post-operation, is valuable
across many industries. This demo shows how to leverage the MongoDB
modern, multi-cloud database platform to go from zero to lift-off in a
rocket launch example.

A typical rocket launch spans an eight-hour period from the time the
initial countdown begins until the rocket payload is in orbit. During
this window, approximately one million metrics are generated per second
by sensors capturing the rocket’s performance. While the metrics make up
the bulk of the data in this scenario, there are two other sources of
data: notes and weather data.

- Notes are created by both rocket engineers and an automated system. The
  rocket engineers create notes when they want to mark a time period or
  situation that they want to remember to revisit after the launch. An
  automated system is continuously watching the metrics as they stream in,
  creating notes whenever parameters reach thresholds that are out of
  bounds.

- Weather data is retrieved from a third party, and stored in an Amazon S3
  bucket, and analyzed in combination with the launch data post-launch.

This solution shows how the various components of MongoDB's modern,
multi-cloud database platform can be used together to support
application-driven analytics on IoT data by highlighting a rocket
launch, with analysis happening during the launch and after. It uses an
open source data set from a Blue Origin rocket launch along with
fictional data.

Other Applicable Industries and Use Cases
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Other industries that leverage IoT sensor data for both real-time and
post-event analytics include:

- Manufacturing: Oftentimes manufacturing machinery is loaded with IoT
  sensors that operate for hours at a time, similar to a rocket launch.
  It’s important that analysis can be done while the machinery is
  operating and post-operation.

- Logistics: From the modes of transportation to the packages themselves,
  IoT sensors enable supply chain optimization both while in-transit and
  post-transit.

- eCommerce: In addition to warehouses and shipping logistics, retailers
  use real-time insights to drive personalization or improve business
  processes.

Reference Architectures
-----------------------

Without MongoDB
~~~~~~~~~~~~~~~

Without MongoDB, this solution often requires a variety of bolt-on or
disparate databases to support the variety of data types being
generated, and data needs to be moved and transformed to reach the
systems that are used to action this data (like a BI tool).

.. figure:: /includes/images/industry-solutions/rocket-launch-without-MongoDB.svg
   :figwidth: 1200px
   :alt: reference architecture without MongoDB

   Figure 1. Reference architecture without MongoDB

With MongoDB
~~~~~~~~~~~~

.. figure:: /includes/images/industry-solutions/rocket-launch-with-MongoDB.svg
   :figwidth: 1200px
   :alt: reference architecture with MongoDB

   Figure 2. Reference architecture with MongoDB

Data Model Approach
-------------------

Review of the Atlas cluster deployed for the demonstration, and overview
of the document model for two main Atlas collections used to store the
launch data: launchData and notes. There are two main collections used
in the demo:

- LaunchData.

- Notes.

In general, the rocket metrics are produced by the rockets in 4-element
tuples having the structure below:

- device, timestamp, metric, value.

In the real-world scenario that inspired this demonstration, an
intermediate app server collected these tuples and aggregated them by
device and timestamp. When all the metrics for a given device and
timestamp were received, these metrics were written to the launchData
collection as a single document. This document model groups the metrics
into documents that match the way the data is read and analyzed by the
application (by device and time). This follows the MongoDB schema design
principle that data that is accessed together is stored together. This
document model also was designed to work with MongoDB time-series
collections. The time and metrics fields are top-level fields and the
meta data (device name) is encapsulated in a field called “meta”.

.. code-block:: javascript  
   :copyable: true  

   {
    _id: ObjectId("62f2f8b5800b621ee724bb94"),
    time: ISODate("2020-10-13T13:33:30.219Z"),
    meta: { device: 'truth' },
    TIME_NANOSECONDS_TAI: Long("1602596010219040000"),
    truth_pos_CON_ECEF_ECEF_M2: -5268929.31643981,
    truth_pos_CON_ECEF_ECEF_M1: -1387897.36558835,
    truth_pos_CON_ECEF_ECEF_M3: 3306577.65409484,
    truth_vel_CON_ECEF_ECEF_MpS2: -0.00810950305119273,
    truth_vel_CON_ECEF_ECEF_MpS3: 0.00414972080992211,
    truth_quat_CON2ECEF1: -0.458400879273711,
    truth_quat_CON2ECEF2: -0.176758395646534,
    truth_quat_CON2ECEF3: 0.511475024782863,
    truth_vel_CON_ECEF_ECEF_MpS1: 0.00220006484335229,
    truth_quat_CON2ECEF4: 0.7049953208872
   }

This data can be found in the file `aerospace.archive.gz
<https://github.com/mongodb-developer/rocket-analytics/blob/main/data-Atlas/aerospace.archive.gz>`__
and restored to an Atlas cluster using mongorestore as below.

Building the Solution
---------------------

This rocket launch solution was recorded over a three-part livestream.
This `GitHub <https://github.com/jayrunkel/rocketLivestream>`__ provides
all the code, data, and links to recordings you need to get started
building out application-driven analytics that revolve around
time-stamped IoT sensor data.

.. procedure::
   :style: normal

   .. step:: Development Environment Setup

      Prior to watching any of the livestreams, you’ll want to go
      through the setup steps listed in  `GitHub readme
      <https://github.com/jayrunkel/rocketLivestream>`__. This will help
      you get started with an Atlas free tier account (if you don’t
      already have one) and download Compass.

   .. step:: **Set Up MongoDB Atlas**

      In order to make the demo work from end to end, you will need to
      set up the backend.

      The first step is to create a MongoDB cluster. If you don’t have
      an Atlas account, `create an account following these steps
      <https://www.mongodb.com/docs/guides/atlas/account/>`__. Once
      that’s complete, under the Data Services tab, click "Database" in
      the sidebar, then "+ Create" to `create a new MongoDB cluster
      <https://www.mongodb.com/docs/atlas/tutorial/create-new-cluster/>`__
      in your preferred region. 

      After your cluster is ready, you’ll need to replicate the
      application database. This database includes sample vehicle and
      sensor data, which are necessary to start using the app. To load
      this data, a dump file is available in the `GitHub repository
      <https://github.com/mongodb-industry-solutions/automotive-acoustic-diagnostics/tree/main?tab=readme-ov-file#step-2---set-up-mongodb-atlas>`__,
      which you can use with the *mongorestore* command to import the
      data into your cluster.

   .. step:: **Anomaly Detection through Sound Input**

      Complete instructions can be found on `this GitHub page
      <https://github.com/mongodb-industry-solutions/automotive-acoustic-diagnostics/tree/main/acoustic-diagnostics-api>`__,
      including how to set up the analytics dashboard, link it to the
      correct data source, and create a vector search index.

   .. step:: **Integrate AWS Bedrock for AI-enhanced Analytics**

      We have followed a simple approach to integrate with AWS Bedrock,
      which can serve as a baseline for more complex approaches
      implementing more real-time data from sensors and implementing a
      `retrieval-augmented generation (RAG) architecture
      <https://www.mongodb.com/resources/basics/artificial-intelligence/retrieval-augmented-generation>`__.

      To learn how to integrate AWS Bedrock with Atlas Triggers, `see
      our GitHub page
      <https://github.com/mongodb-industry-solutions/automotive-acoustic-diagnostics/tree/main?tab=readme-ov-file#step-4---integrate-aws-bedrock-for-ai-enhanced-analytics>`__. 

   .. step:: **Run the Web Portal UI**

      The web portal, built with Next.js, includes the vehicle's digital
      twin, an acoustic diagnostics interface for audio streaming and
      training, and the analytics dashboard. To set it up, update the
      environment variables with your MongoDB cluster connection string
      and the URL of your `Atlas Charts
      <https://www.mongodb.com/products/platform/atlas-charts>`__
      dashboard. Once updated, simply run the Next.js application. Refer
      to the `GitHub repository
      <https://github.com/mongodb-industry-solutions/automotive-acoustic-diagnostics/tree/main/web-app>`__
      for specific commands and additional setup details.

   .. step:: **Bonus! Control Your Vehicle from a Mobile Device**

      For a more realistic connected vehicle experience, you can control
      the engine replica and digital twin from a mobile app. Open the
      Swift project in Xcode, update the environment variables, and run
      the app on an emulator or your own iOS phone or tablet.

Key Learnings
-------------

- **Enhanced diagnostics:** Integrating Atlas Vector Search with audio
  diagnostics enables precise identification of engine statuses and
  anomalies, providing deeper insights into root causes.

- **Real-time monitoring:** Using MongoDB and Atlas Vector Search allows for
  real-time data processing and immediate response to anomalies, crucial
  for proactive maintenance.

- **Data integration:** MongoDB’s document model efficiently handles diverse
  data types, simplifying the integration of structured telemetry data and
  unstructured audio data.

- **Scalability:** The architecture supports scalable data management,
  accommodating the vast volume of IoT signals generated in a
  manufacturing environment.

- **Automation:** AWS Bedrock automates the generation of detailed reports
  based on detected anomalies, streamlining the reporting process.

Technologies and Products Used
------------------------------

MongoDB Developer Data Platform
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- `MongoDB Atlas Vector Search
  <https://www.mongodb.com/products/platform/atlas-vector-search>`__
- `MongoDB Change Streams
  <https://www.mongodb.com/docs/manual/changeStreams/>`__ 
- `Atlas Database
  <https://www.mongodb.com/products/platform/atlas-database>`__
- `Atlas Triggers
  <https://www.mongodb.com/docs/atlas/app-services/triggers/>`__
- `Atlas Charts
  <https://www.mongodb.com/products/platform/atlas-charts>`__

Partner Technologies
~~~~~~~~~~~~~~~~~~~~

- `Amazon Bedrock
  <https://cloud.mongodb.com/ecosystem/amazon-bedrock>`__ 
- `NextJS
  <https://nextjs.org/>`__
- Audio embedding with `panns-inference
  <https://github.com/qiuqiangkong/panns_inference>`__

Authors
-------

- Humza Akthar, MongoDB
- Rami Pinto, MongoDB
- Ainhoa Mugica, MongoDB